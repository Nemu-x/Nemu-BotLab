# Руководство по созданию тестового опросника с автоответом

## Введение

Это руководство поможет вам создать опросник (Flow) с 10 последовательными вопросами и автоматическим ответом на основе полученных данных. Такой опросник может использоваться для:

- Проведения тестирования знаний
- Сбора информации о клиенте
- Квалификации лидов
- Автоматизации процесса поддержки

## Шаг 1: Создание нового Flow

1. Перейдите в раздел "Опросники" в админ-панели
2. Нажмите кнопку "Создать опросник"
3. Заполните основную информацию:
   - **Название**: "Тестовый опросник"
   - **Описание**: "Опросник из 10 вопросов с автоматическим ответом"
   - **Активность**: Включено
   - **Команда запуска**: Выберите существующую команду или создайте новую (например, `/test`)

## Шаг 2: Создание вопросов

Создайте 10 последовательных вопросов. Для каждого вопроса:

1. Нажмите "Добавить шаг"
2. Заполните информацию:
   - **Заголовок**: "Вопрос X" (где X - номер вопроса)
   - **Сообщение**: Текст вопроса
   - **Кнопки**: Добавьте варианты ответов (если нужно)

### Пример структуры вопросов:

#### Вопрос 1: Базовая информация
- **Заголовок**: "Вопрос 1"
- **Сообщение**: "Как вас зовут?"
- **Тип кнопок**: Без кнопок (ожидание текстового ввода)

#### Вопрос 2: Выбор из вариантов
- **Заголовок**: "Вопрос 2"
- **Сообщение**: "Выберите вашу возрастную группу:"
- **Тип кнопок**: Inline
- **Кнопки**:
  - "18-25" (значение: "18-25")
  - "26-35" (значение: "26-35")
  - "36-45" (значение: "36-45")
  - "46+" (значение: "46+")

#### Вопрос 3-9: Дополнительные вопросы
Создайте остальные вопросы по аналогии, чередуя типы вопросов (текстовые, с выбором вариантов и т.д.)

#### Вопрос 10: Заключительный вопрос
- **Заголовок**: "Вопрос 10"
- **Сообщение**: "Спасибо за ответы! Хотите получить результат?"
- **Тип кнопок**: Inline
- **Кнопки**:
  - "Да" (значение: "yes")
  - "Нет" (значение: "no")

## Шаг 3: Настройка логики обработки ответов

Для создания автоответа на основе полученных данных:

1. Добавьте дополнительный шаг "Результат"
2. В поле "Сообщение" используйте шаблон с переменными:
   ```
   Спасибо за прохождение теста, {{name}}!
   
   Ваши ответы:
   1. Имя: {{answers.1}}
   2. Возраст: {{answers.2}}
   3. {{question3}}: {{answers.3}}
   ...
   
   На основе ваших ответов, мы рекомендуем:
   {{recommendation}}
   ```

3. Добавьте условия для формирования рекомендаций на основе ответов:
   - Если ответ на вопрос 2 = "18-25" и ответ на вопрос 5 = "X", то рекомендация A
   - Если ответ на вопрос 2 = "26-35" и ответ на вопрос 5 = "Y", то рекомендация B
   - И т.д.

## Шаг 4: Техническая реализация

Для реализации автоответа потребуется добавить логику в бота. В файле `bot.service.js` нужно:

1. Сохранять все ответы пользователя
2. Анализировать ответы после завершения опросника
3. Формировать персонализированный ответ

### Пример кода для обработки ответов:

```javascript
// В методе processFlowResponse добавить:
if (currentStep.isLastStep) {
  // Анализируем ответы
  const answers = this.clientSurveyState[clientId].answers;
  let recommendation = '';
  
  // Пример логики формирования рекомендации
  if (answers[2] === '18-25') {
    if (answers[5] === 'option1') {
      recommendation = 'Рекомендация A';
    } else {
      recommendation = 'Рекомендация B';
    }
  } else if (answers[2] === '26-35') {
    recommendation = 'Рекомендация C';
  } else {
    recommendation = 'Рекомендация D';
  }
  
  // Формируем сообщение с результатом
  let resultMessage = `Спасибо за прохождение теста, ${answers[1]}!\n\n`;
  resultMessage += `Ваши ответы:\n`;
  
  // Добавляем все ответы
  Object.keys(answers).forEach(questionNum => {
    resultMessage += `${questionNum}. ${answers[questionNum]}\n`;
  });
  
  resultMessage += `\nНаша рекомендация: ${recommendation}`;
  
  // Отправляем результат
  await this.bot.sendMessage(chatId, resultMessage);
}
```

## Шаг 5: Тестирование

1. Сохраните опросник
2. Откройте Telegram и отправьте команду `/test` боту
3. Пройдите все 10 вопросов
4. Проверьте, что автоответ формируется корректно

## Дополнительные возможности

- **Сохранение результатов**: Добавьте сохранение результатов в базу данных для дальнейшего анализа
- **Экспорт данных**: Реализуйте возможность экспорта результатов в CSV или Excel
- **Уведомления**: Настройте отправку уведомлений администраторам о завершенных тестах
- **Аналитика**: Добавьте дашборд с аналитикой по ответам пользователей

## Заключение

Используя данное руководство, вы можете создать интерактивный опросник с автоматическим анализом ответов и формированием персонализированных рекомендаций. Такой подход позволяет автоматизировать процесс взаимодействия с пользователями и предоставлять им ценную информацию без участия оператора. 